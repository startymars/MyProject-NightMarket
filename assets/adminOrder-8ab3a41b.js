import{_ as O,b}from"./PaginationView-53fb9001.js";import{bs as g,aG as k,at as a,p as i,q as t,F as _,aE as h,y as M,aU as o,o as x,bm as m,b7 as y,ax as w,au as C}from"./index-39dbbeaa.js";import"./_commonjsHelpers-87174ba5.js";const{VITE_APP_URL:u,VITE_APP_PATH:p}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"cream21",BASE_URL:"/MyProject-NightMarket/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},P={data(){return{orders:{},tempOrder:{},page:{},bsModal:"",deleteModal:""}},components:{Pagination:O},methods:{getOrders(s=1){this.$http.get(`${u}/v2/api/${p}/admin/orders/?page=${s}`).then(n=>{this.orders=n.data.orders,this.page=n.data.pagination}).catch(n=>{alert(n.response.data)})},openModal(s,n){s==="edit"?(this.bsModal.show(),this.tempOrder={...n}):s==="delete"?(this.deleteModal.show(),this.tempOrder={...n}):s==="deleteAll"&&this.deleteModal.show()},deleteOrder(){this.$http.delete(`${u}/v2/api/${p}/admin/order/${this.tempOrder.id}`).then(s=>{this.getOrders(),this.deleteModal.hide(),alert("已刪除訂單",s.data)}).catch(s=>{alert(s.response.data)})},deleteAllOrder(){this.$http.delete(`${u}/v2/api/${p}/admin/orders/all`).then(s=>{this.getOrders(),this.deleteModal.hide(),alert("已刪除訂單",s.data)}).catch(s=>{alert(s.response.data)})}},mounted(){this.getOrders(),this.bsModal=new b.Modal(this.$refs.modal),this.deleteModal=new b.Modal(this.$refs.delOrderModal)}},l=s=>(w("data-v-d4dcb67a"),s=s(),C(),s),E={class:"container order"},A={class:"title d-flex justify-content-between align-items-center"},V=l(()=>t("h4",null,"訂單管理",-1)),S={class:"table mt-4"},I=l(()=>t("thead",null,[t("tr",null,[t("th",{width:"120"},"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",{width:"120"},"應付金額"),t("th",{width:"100"},"是否付款"),t("th",{width:"120"},"編輯")])],-1)),L={class:"text-left"},D={class:"list-unstyled"},U={class:"text-right"},T={class:"form-check form-switch"},R=["id","onUpdate:modelValue","onChange"],B=["for"],N={key:0},j={key:1},q={class:"btn-group"},$=["onClick"],F=["onClick"],H={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},G={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},J=l(()=>t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),K={class:"modal-body"},Q={class:"row"},W={class:"col-md-4"},X=l(()=>t("h3",null,"用戶資料",-1)),Y={class:"table"},Z={key:0},tt=l(()=>t("th",{style:{width:"100px"}},"姓名",-1)),et=l(()=>t("th",null,"Email",-1)),st=l(()=>t("th",null,"電話",-1)),lt=l(()=>t("th",null,"地址",-1)),dt={class:"col-md-8"},ot=l(()=>t("h3",null,"訂單細節",-1)),nt={class:"table"},at=l(()=>t("th",{style:{width:"100px"}},"訂單編號",-1)),it=l(()=>t("th",null,"下單時間",-1)),rt=l(()=>t("th",null,"付款時間",-1)),ct={key:0},_t={key:1},ht=l(()=>t("th",null,"付款狀態",-1)),ut={key:0,class:"text-success"},pt={key:1,class:"text-muted"},bt=l(()=>t("th",null,"總金額",-1)),mt=l(()=>t("h3",null,"選購商品",-1)),yt={class:"table"},ft=l(()=>t("thead",null,[t("tr")],-1)),vt={class:"text-end"},Ot={class:"d-flex justify-content-end"},gt={class:"form-check"},kt={class:"form-check-label",for:"flexCheckDefault"},Mt={key:0},xt={key:1},wt={class:"modal-footer"},Ct=l(()=>t("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1)),Pt={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Et={class:"modal-dialog"},At={class:"modal-content border-0"},Vt=l(()=>t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delOrderModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),St=l(()=>t("div",{class:"modal-body"},"是否刪除訂單(刪除後將無法恢復)。",-1)),It={class:"modal-footer"},Lt=l(()=>t("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"}," 取消 ",-1));function Dt(s,n,Ut,Tt,d,c){const f=k("Pagination");return a(),i(_,null,[t("div",E,[t("div",A,[V,t("button",{class:"btn btn-primary btn-sm",type:"button",onClick:n[0]||(n[0]=e=>c.openModal("deleteAll"))}," 刪除所有產品 ")]),t("table",S,[I,t("tbody",null,[(a(!0),i(_,null,h(d.orders,e=>(a(),i("tr",{key:e.id},[t("td",null,o(e.create_at),1),t("td",null,o(e.user.email),1),t("td",L,[t("ul",D,[(a(!0),i(_,null,h(e.products,(r,v)=>(a(),i("li",{key:v},o(r.product.title)+" 數量："+o(r.qty)+" "+o(r.product.unit),1))),128))])]),t("td",U,o(e.total),1),t("td",null,[t("div",T,[m(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${e.id}`,"onUpdate:modelValue":r=>e.is_paid=r,onChange:r=>s.updatePaid(e)},null,40,R),[[y,e.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?(a(),i("span",N,"已付款")):(a(),i("span",j,"未付款"))],8,B)])]),t("td",null,[t("div",q,[t("button",{type:"button",class:"btn btn-outline-dark btn-sm",onClick:r=>c.openModal("edit",e)}," 檢視 ",8,$),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>c.openModal("delete",e)}," 刪除 ",8,F)])])]))),128))])]),M(f,{pages:d.page,onEmitChange:c.getOrders},null,8,["pages","onEmitChange"])]),t("div",H,[t("div",G,[t("div",z,[J,t("div",K,[t("div",Q,[t("div",W,[X,t("table",Y,[d.tempOrder.user?(a(),i("tbody",Z,[t("tr",null,[tt,t("td",null,o(d.tempOrder.user.name),1)]),t("tr",null,[et,t("td",null,o(d.tempOrder.user.email),1)]),t("tr",null,[st,t("td",null,o(d.tempOrder.user.tel),1)]),t("tr",null,[lt,t("td",null,o(d.tempOrder.user.address),1)])])):x("",!0)])]),t("div",dt,[ot,t("table",nt,[t("tbody",null,[t("tr",null,[at,t("td",null,o(d.tempOrder.id),1)]),t("tr",null,[it,t("td",null,o(d.tempOrder.create_at),1)]),t("tr",null,[rt,t("td",null,[d.tempOrder.paid_date?(a(),i("span",ct,o(s.$filters.date(d.tempOrder.paid_date)),1)):(a(),i("span",_t,"時間不正確"))])]),t("tr",null,[ht,t("td",null,[d.tempOrder.is_paid?(a(),i("strong",ut,"已付款")):(a(),i("span",pt,"尚未付款"))])]),t("tr",null,[bt,t("td",null,o(d.tempOrder.total),1)])])]),mt,t("table",yt,[ft,t("tbody",null,[(a(!0),i(_,null,h(d.tempOrder.products,e=>(a(),i("tr",{key:e.id},[t("th",null,o(e.product.title),1),t("td",null,o(e.qty)+" / "+o(e.product.unit),1),t("td",vt,o(e.final_total),1)]))),128))])]),t("div",Ot,[t("div",gt,[m(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[1]||(n[1]=e=>d.tempOrder.is_paid=e)},null,512),[[y,d.tempOrder.is_paid]]),t("label",kt,[d.tempOrder.is_paid?(a(),i("span",Mt,"已付款")):(a(),i("span",xt,"未付款"))])])])])])]),t("div",wt,[Ct,t("button",{type:"button",class:"btn btn-primary",onClick:n[2]||(n[2]=e=>s.$emit("update-paid",d.tempOrder))}," 修改付款狀態 ")])])])],512),t("div",Pt,[t("div",Et,[t("div",At,[Vt,St,t("div",It,[Lt,t("button",{type:"button",class:"btn btn-danger",onClick:n[3]||(n[3]=(...e)=>c.deleteAllOrder&&c.deleteAllOrder(...e))}," 確認刪除 ")])])])],512)],64)}const jt=g(P,[["render",Dt],["__scopeId","data-v-d4dcb67a"]]);export{jt as default};
